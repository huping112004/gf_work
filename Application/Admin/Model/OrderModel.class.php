<?php// +----------------------------------------------------------------------// | OneThink [ WE CAN DO IT JUST THINK IT ]// +----------------------------------------------------------------------// | Copyright (c) 2013 http://www.onethink.cn All rights reserved.// +----------------------------------------------------------------------// | Author: yangweijie <yangweijiester@gmail.com> <code-tech.diandian.com>// +----------------------------------------------------------------------namespace Admin\Model;use Think\Model;/** * 插件模型 * @author yangweijie <yangweijiester@gmail.com> */class OrderModel extends Model{    /**     * 查找后置操作     */    protected function _after_find(&$result, $options)    {    }    protected function _after_select(&$result, $options)    {        foreach ($result as &$record) {            $this->_after_find($record, $options);        }    }    /**     * 文件模型自动完成     * @var array     */    protected $_auto = array(        array('create_time', NOW_TIME, self::MODEL_INSERT),    );    /**     * 获取插件列表     * @param string $addon_dir     */    public function getList($addon_dir = '')    {        $total = $this->count();        if (isset($_REQUEST['r'])) {            $listRows = (int)$_REQUEST['r'];        } else {            $listRows = C('LIST_ROWS') > 0 ? 10 : 10;        }        $page = new \Think\Page($total, $listRows, $_REQUEST);        if ($total > $listRows) {            $page->setConfig('theme', '%FIRST% %UP_PAGE% %LINK_PAGE% %DOWN_PAGE% %END% %HEADER%');        }        $p = $page->show();        // $this->assign('_page', $p? $p: '');        // $this->assign('_total',$total);        //$options['limit'] = $page->firstRow . ',' . $page->listRows;        //$this->setProperty('options', $options);        $perfix = C('DB_PREFIX');        if (empty($fields)) {            $fields = array($perfix . "order.*", $perfix . "user.job_number", $perfix . "user.id_card",$perfix . "product.title");        }        // $offset = ($current_page - 1)*$page_size;        $list = $this->join("INNER JOIN {$perfix}user ON {$perfix}order.user_id={$perfix}user.id")            ->join("left join {$perfix}product ON {$perfix}product.id={$perfix}order.product_id")            ->field($fields)            ->order("{$perfix}order.id desc")->limit($page->firstRow . ',' . $page->listRows)            ->select();        return array(            'list'=>$list,            'page'=>$p? $p: '',            'total'=>$total        );    }}